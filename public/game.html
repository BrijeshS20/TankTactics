<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <title>Tank Tactics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.1.1/cerulean/bootstrap.min.css">
    <style>
        #homelink {
            color: white;
            text-decoration: none;
        }

        #help {
            display: none;
            color: white;
        }

        #helplist {
            list-style-type: none;
        }

        #game {
            display: none;
        }

        div#game > div#lobbies.col-2.border-end > div.row > a {
            text-decoration: none;
            color: white;
        }

    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
        let help = document.querySelector("#help");
        let home = document.querySelector("#home");
        let game = document.querySelector("#game");

        let lobbies = document.querySelector("#lobbies");
        let gameview = document.querySelector("#gameview");
        let playerInterface = document.querySelector("#playerinterface");

        let homelink = document.querySelector('#homelink');
        let helplink = document.querySelector('#helplink');
        let gamelink = document.querySelector('#gamelink');

        let playerdata;
        /* try {
            playerdata = jQuery.get('https://tanktactics.uc.r.appspot.com/data',
                {channelId: 89297259044708761, userId: 794921502230577182}, "json");
        } catch (ex) {
            let scr = document.createElement("script");
            scr.src = "https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js";
            document.body.appendChild(scr);
            playerdata = jQuery.get('https://tanktactics.uc.r.appspot.com/data',
                {channelId: 89297259044708761, userId: 794921502230577182}, "json");
        }
        */
        playerdata = {
            "id": "794921502230577182",
            "color": {
                "color": "#ffffff",
                "emote": ":white_circle:"
            },
            "name": "deepparag",
            "x": 21,
            "y": 18,
            "actionPoints": 3,
            "hour": 3,
            "health": 3,
            "lastAttack": 0,
            "accuracy": 80,
            "playerId": 0
        }

        let playerset = new Set();
        playerset.add('DaWise_Weirdo');
        playerset.add('deepparag');
        playerset.add('ThunderX');
        let playerlist = '';

        for (let player of playerset.values())
            if (!(player === playerdata['name']))
                playerlist += `<li class="dropdown-item">${player}</li>`

        playerInterface.innerHTML = `
            <span class="dot"></span> Player ID: ${playerdata['playerId']}
            <br>
            <h6>${playerdata['name']}</h6>
            Action Points: ${playerdata['actionPoints']}
            <br>
            Health: ${playerdata['health']}
            <br>
            Accuracy: ${playerdata['accuracy']}
            <hr>
            <div class="dropdown">
                <div class="btn-group dropstart" role="group">
                    <button class="btn btn-outline-light btn-sm dropdown-toggle" id="give" data-toggle="dropdown" data-bs-toggle="dropdown"
                    aria-expanded="false">Give Action Points</button>
                    <ul class="dropdown-menu" aria-labelledby="give">
                        ${playerlist}
                    </ul>
                </div>
            </div>
            <div class="dropdown">
                <div class="btn-group dropstart" role="group">
                    <button class="btn btn-outline-light btn-sm dropdown-toggle" id="attack" data-toggle="dropdown" data-bs-toggle="dropdown"
                     aria-expanded="false">Attack Opponents</button>
                    <ul class="dropdown-menu" aria-labelledby="attack">
                        ${playerlist}
                    </ul>
                </div>
            </div>
            <hr>
            <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-light">Left</button>
                <button class="btn btn-outline-light">Up</button>
            </div>
            <div class="btn-group btn-group-sm" role="group">
                <button class="btn btn-outline-light">Right</button>
                <button class="btn btn-outline-light">Down</button>
                <br>
            </div>
        `;
        let dot = document.querySelector('.dot');
        dot.style.height = "12px";
        dot.style.width = "12px";
        dot.style.display = 'inline-block';
        dot.style.borderRadius = "50%";
        dot.style.backgroundColor = playerdata.color.color;

        let lobbylist = "";
        let lobby_set = new Set();
        let hashtable = {
            'Lobby 1': 'https://tanktactics.uc.r.appspot.com/',
            'Lobby 2': 'https://tanktactics.uc.r.appspot.com/',
            'Lobby 3': 'https://tanktactics.uc.r.appspot.com/',
            'Lobby 4':'https://tanktactics.uc.r.appspot.com/',
            'Lobby 5':'https://tanktactics.uc.r.appspot.com/',
            'Lobby 6':'https://tanktactics.uc.r.appspot.com/',
            'Lobby 7':'https://tanktactics.uc.r.appspot.com/',
            'Lobby 8':'https://tanktactics.uc.r.appspot.com/',
            'Lobby 9':'https://tanktactics.uc.r.appspot.com/',
            'Lobby 10':'https://tanktactics.uc.r.appspot.com/',
            'Lobby 11':'https://tanktactics.uc.r.appspot.com/',
            'Lobby 12':'https://tanktactics.uc.r.appspot.com/',
        };
        let key_array = Object.keys(hashtable);

            // Helper Functions:
            function showHome() {
                game.style.display = "none";
                help.style.display = "none";
                home.style.display = "block";
            }

            function showHelp() {
                game.style.display = "none";
                home.style.display = "none";
                help.style.display = "block";
            }

            function showGame() {
                // Make the Game Page visible
                home.style.display = "none";
                help.style.display = "none";
                game.style.display = "flex";

                // Make the list of lobbies on the left
                for (let key of key_array) {
                    if (lobbylist.length == 0)
                    {
                        lobbylist += `<h6>Active Lobbies</h6>`;
                    }
                    let lobby = `<div class="row"><a href="${hashtable[key]}">Join ${key}</a></div>`;
                    if (lobby_set.has(lobby) == false)
                    {
                        lobby_set.add(lobby);
                        lobbylist += lobby;
                    }
                }
                lobbies.innerHTML = lobbylist;


                var testGameData = {
                    "users": [
                        {
                            "id": "794921502230577182",
                            "color": {
                                "color": "#ffffff",
                                "emote": ":white_circle:"
                            },
                            "name": "deepparag",
                            "x": 21,
                            "y": 18,
                            "actionPoints": 3,
                            "hour": 3,
                            "health": 3,
                            "lastAttack": 0,
                            "accuracy": 80,
                            "playerId": 0
                        },
                        {
                            "id": "875042500056862721",
                            "color": {
                                "color": "#0015ff",
                                "emote": ":blue_circle:"
                            },
                            "name": "Definitely not a Muse",
                            "x": 7,
                            "y": 30,
                            "actionPoints": 6,
                            "hour": 3,
                            "health": 3,
                            "lastAttack": 0,
                            "accuracy": 80,
                            "playerId": 1
                        },
                        {
                            "id": "792002811583266856",
                            "color": {
                                "color": "#701420",
                                "emote": ":brown_circle:"
                            },
                            "name": "DaWise_Weirdo",
                            "x": 17,
                            "y": 22,
                            "actionPoints": 3,
                            "hour": 2,
                            "health": 3,
                            "lastAttack": 0,
                            "accuracy": 80,
                            "playerId": 2
                        },
                        {
                            "id": "819805772522324008",
                            "color": {
                                "color": "#00a80e",
                                "emote": ":green_circle:"
                            },
                            "name": "Yelena",
                            "x": 21,
                            "y": 23,
                            "actionPoints": 5,
                            "hour": 6,
                            "health": 3,
                            "lastAttack": 0,
                            "accuracy": 80,
                            "playerId": 3
                        },
                        {
                            "id": "762366471371751455",
                            "color": {
                                "color": "#ff6f00",
                                "emote": ":orange_circle:"
                            },
                            "name": "notalivehuman",
                            "x": 28,
                            "y": 23,
                            "actionPoints": 4,
                            "hour": 0,
                            "health": 3,
                            "lastAttack": 0,
                            "accuracy": 80,
                            "playerId": 4
                        },
                        {
                            "id": "840322628807163984",
                            "color": {
                                "color": "#3f00a3",
                                "emote": ":purple_circle:"
                            },
                            "name": "????",
                            "x": 10,
                            "y": 23,
                            "actionPoints": 5,
                            "hour": 1,
                            "health": 3,
                            "lastAttack": 0,
                            "accuracy": 80,
                            "playerId": 5
                        },
                        {
                            "id": "766162972014805023",
                            "color": {
                                "color": "#ff2f00",
                                "emote": ":red_circle:"
                            },
                            "name": "natasha",
                            "x": 7,
                            "y": 14,
                            "actionPoints": 7,
                            "hour": 2,
                            "health": 3,
                            "lastAttack": 0,
                            "accuracy": 80,
                            "playerId": 6
                        }

                    ],
                    "channelId": "892972590447087618",
                    "id": 7,
                    "gameRunning": true,
                    "boardSize": 32
                };

                RenderMap(testGameData);

            // Give/Take Action Points Dropdown.
            }

            homelink.addEventListener('click', showHome);
            helplink.addEventListener('click', showHelp);
            gamelink.addEventListener('click', showGame);

           

            //Draw RenderMap
            function RenderMap(game) {
            
                const width = game.boardSize * 2 * 10 + 10;
                const height = game.boardSize * 2 * 10 + 10;

                const canvas = document.createElement('canvas');
                canvas.setAttribute("width", width);
                canvas.setAttribute("height", height);
                const context = canvas.getContext('2d');
                context.fillStyle = '#343a40';
                context.fillRect(0, 0, width, height)

                context.fillStyle = '#a39c93';
                for (var x = 0; x < game.boardSize; x++) {

                    for (var y = 0; y < game.boardSize; y++) {
                        context.fillRect(x * 20 + 10, y * 20 + 10, 10, 10);
                    }

                }
                game.users.forEach((user) => {
                    context.fillStyle = user.color.color;
                    context.fillRect(user.x * 20 - 1.5, user.y * 20 - 1.5, 13, 13);
                });
                document.getElementById('game-image').src = canvas.toDataURL();
            }
        });
    </script>
</head>

<body class="d-flex h-100 text-center text-white bg-dark container-fluid">
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="mb-auto">
            <div>
                <h3 class="float-md-start mb-0">
                    <a href="#home" id="homelink">
                        Tank Tactics
                    </a>
                </h3>
                <nav class="nav nav-masthead justify-content-center float-md-end">
                    <a class="nav-link active" aria-current="page" href="https://discord.com/login/"
                       target="_blank">Open Discord</a>
                    <a class="nav-link" href="#help" id="helplink">Help</a>
                    <a class="nav-link" href="https://discord.com/api/oauth2/authorize?client_id=893072412558655558&permissions=2048&scope=bot%20applications.commands"
                       target="_blank">Invite the bot</a>
                </nav>
            </div>
            <br><br>
            <hr>
        </header>
        <main class="px-3">
            <div id="home">
                <h1>Tank Tactics</h1>
                <p class="lead">
                    <a class="btn btn-lg btn-secondary fw-bold border-white bg-white" href="#game"
                       id="gamelink">Play Game</a>
                </p>
            </div>
            <div id="help">
                <h1>Help</h1>
                If you face any issues, contact one of the following staff at discord:
                <ul id="helplist">
                    <li>deepparag#6330</li>
                    <li>ThunderX#6969</li>
                    <li>DaWise_Weirdo#1120</li>
                    <li>multiii ;>#7676</li>
                </ul>
            </div>
            <div id="game" class="row">
                <!--Menu Showing List Of Active Lobbies-->

                <div id="lobbies" class="col-2 border-end">

                </div>
                <!-- The Canvas for the Actual Game -->
                <div id="gameview" class="col-8 border-end">
                    <img style="width:100%; height:auto;" id="game-image"/>
                </div>
                <!--Dropdown button with options of attacking and giving points-->
                <div id="playerinterface" class="col-2">
                </div>
            </div>
        </main>
        <footer class="mt-auto text-white-50">
            <hr>
            <p>
                A game which runs on both the communication platform discord and on website. It's idle, real time and co-op.<br> This is war based statergy game in which you have to co-operate with players to win.
                <br>
                A game made by a squad of friends.
            </p>
        </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

</body>

</html>